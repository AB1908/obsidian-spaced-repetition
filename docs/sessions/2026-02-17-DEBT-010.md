# Session: DEBT-010 — 2026-02-17

## Story
[DEBT-010](../stories/DEBT-010-capture-fixture-cycle.md)

## Goal
Complete the capture infrastructure, fix runtime bugs, successfully capture production vault data.

## Findings
- esbuild `__export` creates non-configurable getter-only properties — neither `Object.assign` (BUG-010) nor `Object.defineProperty` (BUG-011) can patch them at runtime
- The original `captureProxy.ts` design was correct all along: import disk → wrap → re-export. An esbuild plugin redirects imports at build time, avoiding all runtime patching issues
- WSL + Windows Obsidian path mismatch: `fs.writeFileSync` in Obsidian's Electron process needs Windows UNC paths (`\\wsl$\Ubuntu\...`), not Linux paths. `wslpath -w` solves this.
- Circular references in Obsidian objects (TFile.parent.children → TFile): solved with belt-and-suspenders approach (known key blocklist + WeakSet cycle detection)
- Input-arg-based filenames (`getFileContents_Atomic-Habits_Annotations.json`) are far easier to navigate than timestamp-based ones
- Commit convention drift: story IDs were on subject line in docs but user convention is body-only. Fixed in CLAUDE.md and work-organization.md.

## Decisions
- esbuild plugin for build-time module redirect (not runtime patching)
- Consolidated captureProxy.ts = proxy logic + disk re-exports (deleted capture-disk.ts and patchApiForCapture.ts)
- `npm run capture` uses `wslpath -w` for Windows UNC paths
- Captured full vault (5 sources, 24 fixtures) — store all now, migrate incrementally to replace old hand-written fixtures
- Commit convention: story IDs in body, not subject line

## Bugs Found
- [BUG-010](../stories/BUG-010-capture-proxy-getter-only-exports.md) — Object.assign fails on getter-only exports
- [BUG-011](../stories/BUG-011-capture-proxy-non-configurable-exports.md) — Object.defineProperty fails on non-configurable exports
- WSL path issue (not filed — environment-specific, fixed in npm script)
- Circular reference in JSON serialization (not filed — fixed inline with safeReplacer)

## Ideas Spawned
- [SPIKE-009](../stories/SPIKE-009-mcp-devtools-feedback-loop.md) — MCP browser DevTools for automated error feedback loop
- [SPIKE-010](../stories/SPIKE-010-codex-parallel-scoping.md) — Codex-delegated parallel scoping via worktrees
- [DEBT-026](../stories/DEBT-026-sanitize-fixture-content.md) — Sanitize fixture content (internal thoughts leaking)
- [DEBT-027](../stories/DEBT-027-formalize-scattered-adrs.md) — Batch-extract ADRs from session artifacts (8+ candidates found)
- [DEBT-028](../stories/DEBT-028-enforce-session-and-divergence-checks.md) — Enforce session logging + plan divergence checks

## Delivered
- Working `npm run capture` that writes production fixtures with readable filenames
- 24 new fixture files from full vault capture (Atomic Habits, Constitution, Memory, Learning, Untitled)
- Capture workflow guide: `docs/guides/capture-fixtures.md`
- Commit convention fix in CLAUDE.md and work-organization.md

## Next Steps
- Sanitize fixture content before making repo public (DEBT-026)
- Add new fixtures to `api.test.ts` mock list and write Atomic Habits test describe block
- Gradual migration: replace old timestamp-named fixtures with new captured ones
- Formalize 8+ scattered ADRs from session artifacts (DEBT-027)
- Enforce session logging and plan divergence checks in workflow (DEBT-028)
- Explore Codex-delegated parallel scoping pattern (SPIKE-010)
