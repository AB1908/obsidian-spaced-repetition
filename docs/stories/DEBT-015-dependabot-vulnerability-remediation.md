# DEBT-015: Dependabot Vulnerability Remediation Plan

## Status
In Progress

## Epic
None

## Branch
chore/security-deps-remediation

## Depends on
- None

## Description
GitHub Dependabot currently reports multiple vulnerabilities (including critical severity) on the default branch. We need a controlled remediation plan that reduces risk without destabilizing plugin runtime behavior.

## Context
Risk areas likely include:
- outdated build/test toolchain packages
- transitive vulnerabilities pulled by legacy major versions
- potential Node runtime mismatch between local and CI/release workflows

Blind bulk upgrades are risky in this repository because release/build behavior and Obsidian compatibility are sensitive to toolchain changes.

## Acceptance Criteria
- [x] Inventory and categorize all open Dependabot alerts by package, severity, and direct/transitive ownership.
- [x] Patch all critical and high severity alerts, or document explicit temporary exceptions with rationale and expiry date.
- [ ] Keep CI green (`npm test`, build, release workflow dry-run after updates).
- [ ] Validate plugin build artifacts still load correctly in Obsidian test vault.
- [x] Document remaining moderate/low alerts and follow-up plan.

## Allowed Files
- `package.json`
- `package-lock.json`
- `.github/workflows/*`
- `docs/guides/*`
- `docs/stories/DEBT-015-dependabot-vulnerability-remediation.md`

## Required Test Commands
- `npm test`
- `OBSIDIAN_PLUGIN_DIR=. npm run build`

## Tasks
- [x] Capture Dependabot snapshot in this story (date-stamped).
- [ ] Upgrade direct dependencies in small batches by risk domain.
- [x] Re-run tests/build after each batch.
- [x] Address CI/runtime compatibility issues (for example Node action versions) as part of remediation.
- [x] Close alerts and record residual risk.

## Related
- `.github/workflows/release.yml`
- `docs/guides/release-playbook.md`

## Session Notes
### 2026-02-17
- Lane A started in worktree `.worktrees/lane-a-security`.
- Scope constrained to DEBT-015 dependency/security remediation and CI runtime alignment.
- Wave 1 batch 1 (commit `96d1cbe`): upgraded CI action majors in `.github/workflows/pr.yml` and `.github/workflows/codeql-analysis.yml`:
  - `actions/checkout` -> `v6`
  - `actions/setup-node` -> `v6`
  - `github/codeql-action/*` -> `v4`
  - aligned CI Node runtime with `CI_NODE_VERSION: 20`
- Wave 1 batch 2 (commit `b9ec9e7`): added tracked `package-lock.json` and updated `yarn.lock` via audit remediation (non-breaking path).
- Required validation after each batch:
  - `npm test` passed
  - `OBSIDIAN_PLUGIN_DIR=. npm run build` passed

## Vulnerability Snapshot (2026-02-17)
Source: local `npm audit --json` (proxy for Dependabot package graph in this worktree).

Baseline before remediation:
- total: 31 (`critical: 2`, `high: 12`, `moderate: 10`, `low: 7`)
- direct vulnerable packages included:
  - `react-router`, `react-router-dom` (high)
  - `esbuild` (moderate)
  - `nanoid` (moderate)
- critical/high transitive exposure included:
  - `@babel/traverse` (critical), `form-data` (critical)
  - `express`/`body-parser`/`qs`/`path-to-regexp` chain (high)
  - `cross-spawn`, `json5`, `semver`, `ws`, and related high findings

Post Wave 1 current state:
- total: 2 (`critical: 0`, `high: 0`, `moderate: 2`, `low: 0`)
- remaining direct moderates:
  - `esbuild` (GHSA-67mh-4wv8-2f99)
  - `nanoid` (GHSA-mwcw-c2x4-8c55)

## Residual Risk and Follow-up
- Remaining alerts require semver-major upgrades (`esbuild@0.27.x`, `nanoid@5.x`) per `npm audit fix --force`.
- Risk decision (temporary): defer those majors to a follow-up compatibility batch because this lane prioritizes critical/high remediation with runtime stability.
- Expiry for deferment: 2026-03-15.
- Follow-up action:
  - run a dedicated major-upgrade branch for `esbuild` and `nanoid`
  - execute full plugin regression checks (including Obsidian vault smoke test) before merge
